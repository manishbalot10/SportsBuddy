import React, { useState, useEffect } from 'react';
import { Player, PrimarySport } from '../types';
import { USER_LOCATION } from '../constants';
import { DownloadPrompt } from './DownloadPrompt';

interface PlayerCardProps {
  player: Player | null;
  onClose: () => void;
  isConnected: boolean;
  onConnect: (playerId: number) => void;
}

const calculateDistance = (lat1: number, lon1: number, lat2: number, lon2: number) => {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon/2) * Math.sin(dLon/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return (R * c).toFixed(1);
};

const StapuBuzzLogo = () => (
  <svg width="120" height="32" viewBox="0 0 233 62" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect width="233" height="62" fill="white"/>
    <path d="M44.4863 39.8701C43.3437 39.8701 42.4384 39.7734 41.7705 39.5801C41.1025 39.4043 40.7685 39.1494 40.7685 38.8154C40.7685 38.6397 40.8916 38.3496 41.1377 37.9453C41.4013 37.5235 41.6035 37.3125 41.7441 37.3125C41.955 37.3125 42.0605 37.3565 42.0605 37.4443C42.0605 37.4971 42.0254 37.5586 41.955 37.6289C41.9023 37.6992 41.8759 37.7695 41.8759 37.8399C41.8759 37.8926 41.9814 37.9717 42.1923 38.0772C42.4209 38.1826 42.7636 38.2793 43.2207 38.3672C43.6777 38.4551 44.2314 38.499 44.8818 38.499C45.9189 38.499 46.8241 38.2969 47.5976 37.8926C48.3886 37.4883 48.995 36.9785 49.4169 36.3633C49.8388 35.7481 50.0497 35.1504 50.0497 34.5703C50.0497 33.8145 49.6806 33.1641 48.9423 32.6192C48.2216 32.0743 47.0527 31.5557 45.4355 31.0635C43.871 30.5538 42.6582 30.1319 41.7968 29.7979C40.9531 29.4464 40.2676 29.0245 39.7402 28.5323C39.2129 28.0226 38.9492 27.4073 38.9492 26.6866C38.9492 25.7198 39.4941 24.7706 40.584 23.839C41.6738 22.8898 43.0185 22.1251 44.6181 21.5451C46.2177 20.9474 47.703 20.6486 49.0741 20.6486C49.7772 20.6486 50.1552 20.7892 50.2079 21.0705C50.2606 21.3517 50.287 21.6681 50.287 22.0197C50.287 22.2833 50.1903 22.4152 49.997 22.4152C49.9091 22.4152 49.8036 22.3888 49.6806 22.3361C49.5751 22.2658 49.4784 22.213 49.3905 22.1779C49.2851 22.1427 49.162 22.1076 49.0214 22.0724C48.8808 22.0373 48.6786 22.0197 48.415 22.0197C47.5009 22.0197 46.4023 22.257 45.1191 22.7316C43.8359 23.2062 42.7197 23.7951 41.7705 24.4982C40.8388 25.2013 40.373 25.878 40.373 26.5284C40.373 27.0558 40.584 27.5128 41.0058 27.8995C41.4453 28.2862 42.0254 28.6202 42.7461 28.9015C43.4668 29.1651 44.4863 29.4991 45.8046 29.9034C47.7382 30.4659 49.162 31.0987 50.0761 31.8018C51.0077 32.5049 51.4735 33.3663 51.4735 34.3858C51.4735 35.2647 51.1747 36.1348 50.577 36.9961C49.997 37.8399 49.1708 38.5254 48.0985 39.0527C47.0439 39.5977 45.8398 39.8701 44.4863 39.8701ZM63.7554 29.1388C62.1382 29.42 61.2329 29.5782 61.0396 29.6134L59.3257 29.9034C59.3257 30.8175 59.3345 31.7755 59.3521 32.7774C59.3872 33.7793 59.4312 34.6582 59.4839 35.4141C59.5542 36.4336 59.6773 37.2158 59.8531 37.7608C60.0288 38.3057 60.1255 38.6133 60.1431 38.6836C60.1431 38.8594 60.0288 39.0176 59.8003 39.1582C59.5894 39.3164 59.3872 39.3955 59.1939 39.3955C59.0884 39.3955 59.0005 39.3603 58.9302 39.29C58.8599 39.2373 58.7984 39.1406 58.7456 39C58.6402 38.7539 58.5347 38.2969 58.4292 37.6289C58.3414 36.961 58.271 36.2227 58.2183 35.4141C58.1656 34.6934 58.1216 33.8584 58.0865 32.9092C58.0689 31.9424 58.0601 31.0108 58.0601 30.1143C57.0757 30.2725 56.065 30.4659 55.0279 30.6944C54.0963 30.8878 53.5426 30.9844 53.3668 30.9844C53.1559 30.9844 52.9537 30.9229 52.7603 30.7999C52.5846 30.6768 52.4967 30.5098 52.4967 30.2989C52.4967 30.0704 52.5758 29.921 52.734 29.8507C52.8922 29.7804 53.1559 29.7452 53.525 29.7452C53.7887 29.7452 54.1754 29.7013 54.6851 29.6134C55.1949 29.5079 55.5201 29.4376 55.6607 29.4024C56.8384 29.1739 57.6382 29.0245 58.0601 28.9542C58.0601 28.585 58.0425 28.1017 58.0074 27.504C57.9722 26.6954 57.9546 26.0802 57.9546 25.6583C57.9546 24.9728 57.9722 24.4454 58.0074 24.0763C58.0601 23.6896 58.148 23.3468 58.271 23.048C58.4117 22.6964 58.6753 22.5206 59.0621 22.5206C59.2203 22.5206 59.3257 22.547 59.3785 22.5997C59.4312 22.6525 59.4576 22.7492 59.4576 22.8898C59.4576 22.9953 59.4136 23.3029 59.3257 23.8126C59.2378 24.3224 59.1939 24.9991 59.1939 25.8429C59.1939 26.4933 59.2115 27.2228 59.2466 28.0313L59.273 28.7433C60.064 28.6202 61.6284 28.295 63.9663 27.7677C64.1069 27.7325 64.2212 27.6095 64.3091 27.3985C64.4145 27.1876 64.52 27.0821 64.6255 27.0821C64.8188 27.0821 65.0122 27.1964 65.2056 27.4249C65.4165 27.6358 65.522 27.8556 65.522 28.0841C65.522 28.3829 65.3901 28.6114 65.1265 28.7696C64.8804 28.9278 64.4233 29.0509 63.7554 29.1388ZM78.1818 38.0244C78.1818 38.2354 78.0939 38.4814 77.9181 38.7627C77.7424 39.0264 77.5666 39.1582 77.3908 39.1582C77.092 39.1582 76.8635 38.9736 76.7053 38.6045C76.5471 38.2354 76.468 37.8047 76.468 37.3125C76.468 36.8906 76.4943 35.625 76.5471 33.5157L76.5734 32.5137C76.5734 32.1094 76.468 31.8194 76.257 31.6436C75.466 32.9795 74.7277 34.1397 74.0422 35.1241C73.3567 36.1084 72.4865 37.0401 71.4319 37.919C70.3772 38.7803 69.2698 39.2109 68.1096 39.2109C67.5471 39.2109 67.1077 39.0352 66.7913 38.6836C66.4925 38.332 66.343 37.875 66.343 37.3125C66.343 36.6094 66.6594 35.6514 67.2923 34.4385C67.9251 33.2081 68.7336 31.9688 69.718 30.7208C70.7024 29.4552 71.6867 28.4181 72.6711 27.6095C73.3215 27.0821 73.84 26.7306 74.2268 26.5548C74.6135 26.3614 74.9562 26.2648 75.2551 26.2648C75.5363 26.2648 75.8264 26.3526 76.1252 26.5284C76.424 26.7042 76.6789 26.9503 76.8898 27.2667C77.1008 27.5831 77.2062 27.9435 77.2062 28.3477C77.2062 28.8927 77.0568 29.4112 76.758 29.9034L77.2062 29.7716C77.3996 29.7716 77.5138 30.0089 77.549 30.4835C77.5666 30.7647 77.5842 31.336 77.6017 32.1973C77.6369 33.0586 77.6633 33.7706 77.6808 34.333C77.6984 34.9131 77.716 35.4756 77.7336 36.0205C77.7511 36.5655 77.7687 36.9961 77.7863 37.3125C77.8039 37.4356 77.8742 37.5674 77.9972 37.708C78.1203 37.8311 78.1818 37.9365 78.1818 38.0244ZM75.8879 30.6153C76.0988 30.088 76.2043 29.5167 76.2043 28.9015C76.2043 28.5323 76.09 28.2159 75.8615 27.9522C75.6506 27.671 75.3605 27.5304 74.9914 27.5304C74.552 27.5304 73.9895 27.8292 73.3039 28.4268C72.5129 29.0948 71.678 29.9913 70.7991 31.1163C69.9202 32.2237 69.1907 33.3223 68.6106 34.4121C68.0305 35.502 67.7405 36.3633 67.7405 36.9961C67.7405 37.5234 67.9866 37.7871 68.4788 37.7871C69.428 37.7871 70.342 37.4356 71.2209 36.7324C72.0998 36.0293 72.882 35.1944 73.5676 34.2276C74.2707 33.2432 75.0441 32.0391 75.8879 30.6153ZM83.7531 36.8906C83.7179 38.0859 83.7003 39.0615 83.7003 39.8174C83.7003 40.8193 83.7443 41.7334 83.8322 42.5595C83.8673 42.8759 83.8849 43.0957 83.8849 43.2187C83.8849 43.5 83.8234 43.7373 83.7003 43.9306C83.5773 44.1416 83.4015 44.247 83.173 44.247C82.8566 44.247 82.6808 44.1328 82.6457 43.9043C82.6281 43.6054 82.6017 43.1396 82.5666 42.5068C82.549 41.8916 82.5402 41.2676 82.5402 40.6348L82.5666 36.9434C82.4787 36.9434 82.3117 36.9522 82.0656 36.9697C81.8371 36.9873 81.6086 36.9961 81.38 36.9961C80.9582 36.9961 80.7472 36.7061 80.7472 36.126C80.7472 35.7041 80.8527 35.4932 81.0636 35.4932C81.1339 35.4932 81.3449 35.5459 81.6964 35.6514C82.048 35.7569 82.3468 35.8096 82.5929 35.8096L82.5666 28.3477C82.4259 28.3302 82.1359 28.3038 81.6964 28.2686C81.257 28.2159 80.9318 28.128 80.7209 28.005C80.5275 27.8819 80.4308 27.7062 80.4308 27.4776C80.4308 27.0206 80.5187 26.7921 80.6945 26.7921C80.8879 26.7921 81.1252 26.8624 81.4064 27.003C81.4416 27.0206 81.547 27.0733 81.7228 27.1612C81.8986 27.2315 82.1447 27.2843 82.4611 27.3194C82.5666 27.0382 82.6632 26.8448 82.7511 26.7394C82.8566 26.6339 83.0499 26.5812 83.3312 26.5812C83.6828 26.5812 83.8585 26.6515 83.8585 26.7921C83.8585 26.8448 83.8322 26.9415 83.7794 27.0821C83.7267 27.2052 83.7003 27.3282 83.7003 27.4513C84.7902 27.6095 86.0206 27.9347 87.3917 28.4268C88.7804 28.9015 89.9757 29.5079 90.9776 30.2462C91.9971 30.9844 92.5069 31.793 92.5069 32.6719C92.5069 33.92 91.6983 34.8868 90.0811 35.5723C88.464 36.2578 86.3546 36.6973 83.7531 36.8906ZM83.6476 28.4532C83.6828 29.4727 83.7091 30.8262 83.7267 32.5137C83.7443 34.1836 83.7531 35.291 83.7531 35.836C84.8077 35.836 85.9327 35.7041 87.128 35.4405C88.3233 35.1592 89.3253 34.7901 90.1339 34.333C90.96 33.8584 91.3731 33.3399 91.3731 32.7774C91.3731 32.0391 90.9512 31.3712 90.1075 30.7735C89.2638 30.1759 88.2442 29.6837 87.0489 29.297C85.8712 28.9102 84.7374 28.629 83.6476 28.4532ZM104.675 39.4482C104.323 39.4482 103.998 39.0791 103.699 38.3408C103.418 37.6026 103.242 36.8379 103.172 36.0469C103.102 35.291 103.049 33.7618 103.014 31.459C102.996 31.0899 102.987 30.7208 102.987 30.3516C102.987 29.9649 102.979 29.6397 102.961 29.3761C102.451 30.5889 101.757 31.9688 100.878 33.5157C99.9991 35.0625 99.1114 36.3897 98.2149 37.4971C97.336 38.6045 96.6153 39.1582 96.0528 39.1582C95.4728 39.1582 95.0861 38.8506 94.8927 38.2354C94.7169 37.6201 94.629 36.6446 94.629 35.3086C94.629 34.0606 94.7872 32.6456 95.1036 31.0635C95.4376 29.4815 95.8155 28.2774 96.2374 27.4513C96.4132 27.0821 96.5626 26.836 96.6856 26.713C96.8087 26.5724 96.9493 26.5021 97.1075 26.5021C97.547 26.5021 97.7667 26.5899 97.7667 26.7657C97.7667 26.8536 97.6788 27.0558 97.503 27.3722C97.0284 28.2511 96.6153 29.3057 96.2638 30.5362C95.9122 31.7667 95.7364 33.419 95.7364 35.4932C95.7364 36.8819 95.9298 37.5762 96.3165 37.5762C96.7735 37.5762 97.3888 37.0752 98.1622 36.0733C98.9532 35.0537 99.7354 33.8409 100.509 32.4346C101.282 31.0284 101.871 29.8067 102.275 28.7696C102.416 28.4181 102.574 27.8731 102.75 27.1349C102.803 26.836 102.856 26.6251 102.908 26.5021C102.961 26.3614 103.023 26.2911 103.093 26.2911C103.286 26.2911 103.497 26.3702 103.726 26.5284C103.954 26.6866 104.068 26.8536 104.068 27.0294C104.068 27.8731 104.095 29.3233 104.147 31.3799C104.218 33.419 104.297 34.834 104.385 35.625C104.455 36.3106 104.578 36.8467 104.754 37.2334C104.947 37.6201 105.132 37.9277 105.308 38.1563C105.483 38.3672 105.571 38.499 105.571 38.5518C105.571 38.833 105.492 39.0527 105.334 39.2109C105.176 39.3691 104.956 39.4482 104.675 39.4482Z" fill="#E17827"/>
    <path d="M113.614 39.3164C112.419 39.3164 111.285 39.0967 110.213 38.6572C109.158 38.2178 108.217 37.5938 107.391 36.7852L109.052 34.7813C109.668 35.3789 110.38 35.8448 111.188 36.1787C112.014 36.4951 112.84 36.6533 113.667 36.6533C114.651 36.6533 115.398 36.4512 115.908 36.0469C116.418 35.6426 116.672 35.1065 116.672 34.4385C116.672 33.9639 116.558 33.586 116.33 33.3047C116.101 33.0059 115.785 32.751 115.38 32.5401C114.994 32.3292 114.537 32.1182 114.009 31.9073L111.636 30.879C111.074 30.6329 110.52 30.3165 109.975 29.9298C109.448 29.5255 109.008 29.0333 108.657 28.4532C108.323 27.8556 108.156 27.1349 108.156 26.2911C108.156 25.3771 108.402 24.5597 108.894 23.839C109.404 23.1007 110.089 22.5206 110.951 22.0988C111.83 21.6593 112.832 21.4396 113.957 21.4396C114.994 21.4396 115.969 21.633 116.883 22.0197C117.815 22.3888 118.606 22.8986 119.256 23.549L117.648 25.5528C117.086 25.0958 116.497 24.7443 115.881 24.4982C115.266 24.2345 114.625 24.1027 113.957 24.1027C113.148 24.1027 112.489 24.2872 111.979 24.6564C111.487 25.0079 111.241 25.5001 111.241 26.1329C111.241 26.5724 111.364 26.9415 111.61 27.2403C111.874 27.5216 112.216 27.7677 112.638 27.9786C113.078 28.172 113.526 28.3653 113.983 28.5587L116.33 29.5343C117.015 29.8331 117.622 30.1846 118.149 30.5889C118.676 30.9932 119.081 31.4854 119.362 32.0655C119.661 32.6456 119.81 33.3575 119.81 34.2012C119.81 35.1328 119.564 35.9854 119.072 36.7588C118.58 37.5322 117.868 38.1563 116.936 38.6309C116.022 39.0879 114.915 39.3164 113.614 39.3164ZM128.245 39.3164C127.033 39.3164 125.934 39.0527 124.95 38.5254C123.983 37.9805 123.218 37.207 122.656 36.2051C122.093 35.1856 121.812 33.9551 121.812 32.5137C121.812 31.1075 122.102 29.9034 122.682 28.9015C123.262 27.8819 124.009 27.0997 124.923 26.5548C125.837 26.0099 126.804 25.7374 127.824 25.7374C129.001 25.7374 129.986 26.0011 130.777 26.5284C131.568 27.0558 132.157 27.7853 132.543 28.7169C132.948 29.6309 133.15 30.6856 133.15 31.8809C133.15 32.1622 133.132 32.4346 133.097 32.6983C133.079 32.962 133.044 33.2168 132.992 33.4629H124.079V31.1426H130.46C130.46 30.211 130.249 29.4815 129.827 28.9542C129.406 28.4093 128.755 28.1368 127.876 28.1368C127.384 28.1368 126.901 28.2686 126.426 28.5323C125.969 28.796 125.582 29.2442 125.266 29.877C124.967 30.5098 124.818 31.3887 124.818 32.5137C124.818 33.5332 124.994 34.3682 125.345 35.0186C125.697 35.6514 126.162 36.126 126.743 36.4424C127.323 36.7412 127.947 36.8906 128.615 36.8906C129.177 36.8906 129.704 36.8115 130.197 36.6533C130.706 36.4951 131.181 36.2754 131.62 35.9942L132.675 37.9453C132.077 38.3672 131.392 38.7012 130.618 38.9473C129.863 39.1934 129.072 39.3164 128.245 39.3164ZM138.874 39.3164C138.119 39.3164 137.451 39.1582 136.871 38.8418C136.29 38.5254 135.833 38.0859 135.499 37.5235C135.183 36.9434 135.025 36.2754 135.025 35.5196C135.025 34.0606 135.631 32.962 136.844 32.2237C138.075 31.4678 140.017 30.9493 142.671 30.668C142.654 30.2286 142.566 29.8243 142.408 29.4552C142.267 29.086 142.021 28.796 141.669 28.585C141.335 28.3565 140.878 28.2423 140.298 28.2423C139.665 28.2423 139.041 28.3565 138.426 28.585C137.829 28.8136 137.24 29.1036 136.66 29.4552L135.552 27.3985C136.027 27.0997 136.545 26.8273 137.108 26.5812C137.67 26.3175 138.268 26.1153 138.901 25.9747C139.534 25.8165 140.193 25.7374 140.878 25.7374C141.951 25.7374 142.838 25.9571 143.541 26.3966C144.262 26.8185 144.798 27.4513 145.15 28.295C145.519 29.1212 145.703 30.1407 145.703 31.3536V39H143.199L142.988 37.5762H142.882C142.285 38.0684 141.661 38.4814 141.01 38.8154C140.36 39.1494 139.648 39.3164 138.874 39.3164ZM139.824 36.8379C140.351 36.8379 140.834 36.7324 141.274 36.5215C141.731 36.293 142.197 35.959 142.671 35.5196V32.7774C141.494 32.918 140.562 33.1026 139.876 33.3311C139.191 33.5596 138.699 33.8409 138.4 34.1748C138.119 34.4912 137.978 34.8692 137.978 35.3086C137.978 35.8535 138.154 36.249 138.505 36.4951C138.857 36.7237 139.296 36.8379 139.824 36.8379ZM149.332 39V26.0538H151.837L152.048 28.3477H152.153C152.611 27.504 153.155 26.8624 153.788 26.423C154.439 25.9659 155.115 25.7374 155.819 25.7374C156.152 25.7374 156.434 25.755 156.662 25.7902C156.891 25.8253 157.102 25.8956 157.295 26.0011L156.689 28.585C156.478 28.5323 156.284 28.4972 156.109 28.4796C155.933 28.4444 155.704 28.4268 155.423 28.4268C154.913 28.4268 154.377 28.629 153.815 29.0333C153.252 29.42 152.769 30.1055 152.364 31.0899V39H149.332ZM164.369 39.3164C163.174 39.3164 162.101 39.0527 161.152 38.5254C160.203 37.9805 159.447 37.207 158.884 36.2051C158.34 35.1856 158.067 33.9639 158.067 32.5401C158.067 31.0987 158.366 29.877 158.964 28.8751C159.561 27.8556 160.352 27.0821 161.337 26.5548C162.339 26.0099 163.411 25.7374 164.553 25.7374C165.38 25.7374 166.1 25.878 166.715 26.1593C167.348 26.423 167.893 26.7657 168.35 27.1876L166.9 29.086C166.619 28.8224 166.294 28.6114 165.924 28.4532C165.573 28.295 165.169 28.2159 164.712 28.2159C164.026 28.2159 163.42 28.4005 162.892 28.7696C162.365 29.1212 161.943 29.6221 161.627 30.2725C161.328 30.9053 161.178 31.6612 161.178 32.5401C161.178 33.4014 161.328 34.1573 161.627 34.8077C161.925 35.4405 162.33 35.9414 162.84 36.3106C163.367 36.6621 163.973 36.8379 164.659 36.8379C165.169 36.8379 165.643 36.7412 166.083 36.5479C166.54 36.3545 166.944 36.1084 167.296 35.8096L168.535 37.6817C167.99 38.1738 167.357 38.5693 166.636 38.8682C165.933 39.167 165.177 39.3164 164.369 39.3164ZM171.09 39V20.3849H174.122V25.1837L174.017 27.6886C174.562 27.1788 175.168 26.7306 175.836 26.3439C176.504 25.9396 177.278 25.7374 178.156 25.7374C179.545 25.7374 180.556 26.1857 181.189 27.0821C181.821 27.9786 182.138 29.2442 182.138 30.879V39H179.106V31.2745C179.106 30.2022 178.947 29.4464 178.631 29.0069C178.315 28.5675 177.796 28.3477 177.075 28.3477C176.513 28.3477 176.012 28.4884 175.573 28.7696C175.151 29.0333 174.667 29.4288 174.122 29.9561V39H171.09Z" fill="#00B0F0"/>
  </svg>
);

export const PlayerCard: React.FC<PlayerCardProps> = ({ player, onClose, isConnected, onConnect }) => {
  const [displayPlayer, setDisplayPlayer] = useState<Player | null>(null);
  const [isVisible, setIsVisible] = useState(false);
  const [showDownloadPrompt, setShowDownloadPrompt] = useState(false);

  useEffect(() => {
    if (player) {
      setDisplayPlayer(player);
      requestAnimationFrame(() => setIsVisible(true));
    } else {
      setIsVisible(false);
    }
  }, [player]);

  if (!displayPlayer) return null;

  const distance = displayPlayer.distance_km ?? calculateDistance(
    USER_LOCATION.latitude, USER_LOCATION.longitude,
    displayPlayer.latitude, displayPlayer.longitude
  );

  return (
    <>
      <div
        className={`fixed bottom-4 left-4 right-4 z-[1000] transition-all duration-300 ease-out ${
          isVisible ? 'translate-y-0 opacity-100' : 'translate-y-8 opacity-0 pointer-events-none'
        }`}
        style={{ 
          maxWidth: '378.08px', 
          margin: '0 auto'
        }}
      >
        {/* Logged-Out Player Card - Based on Figma Design */}
        <div 
          className="flex flex-col justify-center items-center"
          style={{
            width: '378.08px',
            height: '171.2px',
            padding: '11.5443px 23.0886px',
            gap: '14.43px',
            background: 'linear-gradient(99.64deg, #FFFFFF -3.69%, #FFFFFF 121.62%)',
            border: '0.288608px solid rgba(0, 0, 0, 0.1)',
            borderRadius: '11.5443px',
            boxSizing: 'border-box'
          }}
        >
          {/* Main Content Row: Profile + Sports Info */}
          <div className="flex flex-row items-center gap-4 w-full">
            {/* Profile Image */}
            <div className="w-[80px] h-[80px] flex-shrink-0">
              <img
                src={displayPlayer.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(displayPlayer.name)}&background=random&size=80`}
                alt="Player"
                className="w-full h-full rounded-xl object-cover"
              />
            </div>

            {/* Sports Info */}
            <div className="flex flex-col gap-1 flex-1">
              {/* Primary Sports with Rating Dots */}
              {(displayPlayer.primarySports || [{ sport: displayPlayer.sport, level: 4 }]).slice(0, 2).map((primarySport: PrimarySport, idx: number) => (
                <div key={idx} className="flex flex-row items-center justify-between">
                  <span 
                    className="font-semibold"
                    style={{
                      fontFamily: "'Source Sans 3', sans-serif",
                      fontSize: '18px',
                      color: '#1F1F1F',
                    }}
                  >
                    {primarySport.sport}
                  </span>
                  {/* Rating Dots */}
                  <div className="flex flex-row items-center gap-1">
                    {[1, 2, 3, 4, 5].map((dot) => (
                      <div
                        key={dot}
                        className="w-[18px] h-[18px] rounded-full"
                        style={{
                          backgroundColor: dot <= primarySport.level ? '#E17827' : '#DBDBDB',
                        }}
                      />
                    ))}
                  </div>
                </div>
              ))}

              {/* Secondary Sports Tags */}
              {displayPlayer.secondarySports && displayPlayer.secondarySports.length > 0 && (
                <div className="flex flex-row items-center gap-2 mt-1">
                  {displayPlayer.secondarySports.slice(0, 3).map((sport, index, arr) => (
                    <React.Fragment key={sport}>
                      <span
                        style={{
                          fontFamily: "'Source Sans 3', sans-serif",
                          fontSize: '14px',
                          color: 'rgba(0, 0, 0, 0.5)',
                        }}
                      >
                        {sport}
                      </span>
                      {index < arr.length - 1 && (
                        <div 
                          className="w-[1px] h-4"
                          style={{ backgroundColor: 'rgba(0, 0, 0, 0.2)' }}
                        />
                      )}
                    </React.Fragment>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Connect Button - Triggers Download Prompt */}
          <button
            onClick={() => setShowDownloadPrompt(true)}
            className="flex justify-center items-center w-full py-3 rounded-[10px] transition-all active:scale-[0.98]"
            style={{
              backgroundColor: '#E17827',
              fontFamily: "'Source Sans 3', sans-serif"
            }}
          >
            <span
              className="font-semibold"
              style={{
                fontSize: '20px',
                color: '#FAF9F6',
              }}
            >
              Connect
            </span>
          </button>
        </div>
      </div>

      {showDownloadPrompt && (
        <DownloadPrompt 
          isOpen={showDownloadPrompt} 
          onClose={() => setShowDownloadPrompt(false)} 
          playerName={displayPlayer.name}
        />
      )}
    </>
  );
};
